{% extends "layout.html" %}

{% block title %}T H E&nbsp;&nbsp;V O I D{% endblock %}

{% block extra_css %}
<style>
    body { cursor: none; }

    .scream {
        position: absolute;
        white-space: pre-wrap;
        pointer-events: none;
        opacity: 0;
        animation: fadeIn 2s forwards;
        transition: opacity 0.5s ease;
        max-width: 300px;
        text-align: center;
    }

    @keyframes fadeIn {
        to { opacity: var(--target-opacity, 0.8); }
    }

    #void-container {
        width: 100vw;
        height: 100vh;
        position: relative;
        filter: blur(0.5px) contrast(1.1);
        transition: filter 5s ease;
    }

    #eye-glyph {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        display: flex;
        gap: 60px;
        opacity: 0.35;
        pointer-events: auto;
        filter: blur(0.4px);
        z-index: 100;
        transition: opacity 0.4s ease;
    }

    .eye {
        width: 120px;
        height: 48px;
        border: 2px solid rgba(255, 255, 255, 0.4);
        border-radius: 60% / 90%;
        position: relative;
        animation: slowPulse 6s ease-in-out infinite;
    }

    .eye::after {
        content: '';
        position: absolute;
        width: 22px;
        height: 22px;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.6);
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.45);
    }

    .eye.left::after { box-shadow: -6px 0 20px rgba(255,255,255,0.3); }
    .eye.right::after { box-shadow: 6px 0 20px rgba(255,255,255,0.3); }

    @keyframes slowPulse {
        0%, 100% { transform: scaleX(1); }
        50% { transform: scaleX(0.8); }
    }

    body.eyes-open #eye-glyph {
        opacity: 0.9;
        filter: none;
    }

    body.eyes-open #void-container .scream {
        opacity: 1 !important;
        color: rgba(255, 255, 255, 0.95) !important;
        text-shadow: 0 0 18px rgba(255, 255, 255, 0.6);
    }
    
    /* Blink Mode - Squinting Eyes */
    body.blink-mode .eye {
        height: 12px; /* Much narrower */
        border-radius: 50% / 80%;
        border-width: 3px;
        background: rgba(0, 0, 0, 0.5);
        animation: squintPulse 4s ease-in-out infinite;
    }

    body.blink-mode .eye::after {
        width: 14px;
        height: 14px;
        /* Pupil moves slightly */
        animation: search 10s infinite;
    }

    @keyframes squintPulse {
        0%, 100% { transform: scaleX(1); }
        50% { transform: scaleX(0.9); }
    }

    @keyframes search {
        0%, 100% { transform: translate(-50%, -50%); }
        20% { transform: translate(-20%, -50%); }
        40% { transform: translate(-80%, -50%); }
        60% { transform: translate(-50%, -50%); }
        80% { transform: translate(-50%, -50%); }
    }

    .return-link {
        position: fixed;
        bottom: 40px;
        left: 50%;
        transform: translateX(-50%);
        color: #888;
        text-decoration: none;
        font-size: 1.8rem;
        z-index: 1000;
        opacity: 0.6;
        transition: all 0.3s;
        cursor: pointer;
        border: 1px solid #444;
        padding: 15px 30px;
        background-color: rgba(0,0,0,0.8);
        letter-spacing: 3px;
        box-shadow: 0 0 10px rgba(0,0,0,1);
    }
    
    #fall-deeper-btn {
        bottom: 120px;
        font-size: 1.2rem;
        border-color: #600;
        color: #a00;
        opacity: 0.4;
    }
    
    #fall-deeper-btn:hover {
        border-color: #f00;
        color: #f00;
        text-shadow: 0 0 10px #f00;
        box-shadow: 0 0 20px rgba(255, 0, 0, 0.4);
        animation: shake 0.2s infinite;
    }

    .return-link:hover {
        color: #fff;
        border-color: #fff;
        opacity: 1;
        box-shadow: 0 0 20px rgba(255, 255, 255, 0.4), inset 0 0 10px rgba(255, 255, 255, 0.2);
        text-shadow: 2px 2px 0px #ff0000, -2px -2px 0px #0000ff;
        letter-spacing: 6px;
        animation: shake 0.4s infinite;
    }

    /* Fake Wikipedia Overlay - High Fidelity */
    #fake-wiki-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: #ffffff;
        color: #202122;
        font-family: sans-serif;
        z-index: 9999;
        display: none;
        overflow-y: scroll;
        cursor: auto;
    }

    .mw-page-container {
        display: flex;
        max-width: 1400px;
        margin: 0 auto;
        padding: 0;
    }

    .mw-sidebar {
        width: 176px;
        padding: 20px 0;
        flex-shrink: 0;
        font-size: 0.875em;
    }

    .mw-logo {
        display: block;
        width: 135px;
        height: 135px;
        margin: 0 auto 20px;
        background-image: url('https://upload.wikimedia.org/wikipedia/en/8/80/Wikipedia-logo-v2.svg');
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        opacity: 0.9;
    }

    .mw-sidebar-list {
        list-style: none;
        padding: 0 12px;
        margin: 0;
    }

    .mw-sidebar-list li {
        margin-bottom: 6px;
    }

    .mw-sidebar-list a {
        color: #0645ad;
        text-decoration: none;
    }

    .mw-sidebar-list a:hover {
        text-decoration: underline;
    }

    .mw-content-container {
        flex-grow: 1;
        padding: 20px 40px;
        background: #fff;
        border-left: 1px solid #a7d7f9;
        position: relative;
    }

    .mw-header {
        display: flex;
        justify-content: flex-end;
        margin-bottom: 30px;
        font-size: 0.8em;
        gap: 10px;
    }

    .mw-header a { color: #0645ad; text-decoration: none; }

    .firstHeading {
        font-family: 'Linux Libertine', 'Georgia', 'Times', serif;
        font-size: 2.4em;
        font-weight: normal;
        border-bottom: 1px solid #a2a9b1;
        margin-bottom: 0.2em;
        padding-bottom: 0;
        line-height: 1.3;
    }

    .mw-body-content {
        font-size: 0.95em;
        line-height: 1.6;
        color: #202122;
    }

    .mw-body-content p { margin: 0.5em 0 1em; }
    .mw-body-content h2 { 
        font-family: 'Linux Libertine', 'Georgia', 'Times', serif;
        font-weight: normal;
        font-size: 1.8em;
        border-bottom: 1px solid #a2a9b1;
        margin: 1em 0 0.5em;
        padding-bottom: 0.2em;
    }

    .mw-body-content a { color: #3366cc; text-decoration: none; }
    .mw-body-content a:hover { text-decoration: underline; }

    .infobox {
        border: 1px solid #a2a9b1;
        background-color: #f8f9fa;
        color: #202122;
        margin: 0.5em 0 0.5em 1em;
        padding: 0.2em;
        float: right;
        clear: right;
        width: 300px;
        font-size: 88%;
        line-height: 1.5em;
    }
    
    .infobox-header {
        text-align: center;
        background-color: #e1e1e1;
        font-weight: bold;
        padding: 5px;
    }

    .infobox-image {
        padding: 10px;
        text-align: center;
    }
    
    .infobox-image img {
        max-width: 100%;
        height: auto;
        border: 1px solid #ccc;
    }

    .word-span {
        display: inline-block;
        position: relative;
        white-space: pre;
        transition: color 0.2s;
    }

    /* "Attack" classes */
    .attacking-word {
        position: fixed !important;
        z-index: 10000;
        pointer-events: none;
    }
    
    .wait-what {
        position: absolute;
        bottom: 20px;
        right: 20px;
        font-size: 6rem;
        color: rgba(0,0,0,0.03);
        font-weight: bold;
        pointer-events: none;
        transform: rotate(-15deg);
        animation: ghostFade 6s ease-in-out infinite;
    }

    @keyframes ghostFade {
        0%, 100% { opacity: 0; }
        50% { opacity: 1; }
    }

    .whiteout-active {
        animation: whiteout 1.5s forwards ease-in;
    }
    
    @keyframes whiteout {
        0% { filter: brightness(1) contrast(1); background-color: #000; }
        100% { filter: brightness(100) contrast(0); background-color: #fff; opacity: 0; }
    }
</style>
{% endblock %}

{% block content %}
<div id="eye-glyph">
    <div class="eye left"></div>
    <div class="eye right"></div>
</div>

<div id="void-container">
    <!-- Screams will drift here -->
</div>

<a href="#" class="return-link" id="fall-deeper-btn">FALL DEEPER</a>
<a href="{{ url_for('void.index') }}" class="return-link" id="wake-up-btn">WAKE UP</a>

<div id="fake-wiki-overlay">
    <div class="mw-page-container">
        <div class="mw-sidebar">
            <a href="#" class="mw-logo"></a>
            <ul class="mw-sidebar-list">
                <li><a href="#">Main page</a></li>
                <li><a href="#">Contents</a></li>
                <li><a href="#">Current events</a></li>
                <li><a href="#">Random article</a></li>
                <li><a href="#">About Wikipedia</a></li>
                <li><a href="#">Contact us</a></li>
                <li><a href="#">Donate</a></li>
            </ul>
            <div style="margin-top: 20px; padding-left: 12px; font-size: 0.85em; color: #54595d;">
                <strong>Contribute</strong>
                <ul class="mw-sidebar-list" style="margin-top: 5px;">
                    <li><a href="#">Help</a></li>
                    <li><a href="#">Learn to edit</a></li>
                    <li><a href="#">Community portal</a></li>
                    <li><a href="#">Recent changes</a></li>
                    <li><a href="#">Upload file</a></li>
                </ul>
            </div>
        </div>
        <div class="mw-content-container">
            <div class="mw-header">
                <a href="#">Not logged in</a>
                <a href="#">Talk</a>
                <a href="#">Contributions</a>
                <a href="#">Create account</a>
                <a href="#">Log in</a>
            </div>
            <div class="mw-body-content" id="wiki-body-text">
                <div class="infobox">
                    <div class="infobox-header">Semantic satiation</div>
                    <div class="infobox-image">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/a/a3/June_odd-eyed-cat.jpg/440px-June_odd-eyed-cat.jpg" alt="An odd-eyed cat">
                        <div style="font-size: 0.9em; padding-top: 5px;">A visual representation of dissociation.</div>
                    </div>
                    <div style="padding: 5px;">
                        <strong>Other names</strong><br>
                        Verbal satiation
                    </div>
                    <div style="padding: 5px; background: #f8f9fa;">
                        <strong>Specialty</strong><br>
                        <a href="#">Psychology</a>, <a href="#">Cognitive science</a>
                    </div>
                </div>
                
                <h1 class="firstHeading">Semantic satiation</h1>
                <div style="font-size: 0.85em; color: #54595d; margin-bottom: 1em;">From Wikipedia, the free encyclopedia</div>
                
                <p><b>Semantic satiation</b> (also known as <b>verbal satiation</b>) is a psychological phenomenon in which repetition causes a word or phrase to temporarily lose meaning for the listener, who then perceives the speech as repeated meaningless sounds. Extended inspection or analysis (staring at the word or phrase for a long time) in place of repetition also produces the same effect.</p>
                
                <p>The phenomenon was first described and named by <a href="#">Leon Jakobovits James</a> in his 1962 doctoral dissertation at <a href="#">McGill University</a>. Prior to that, the expression "verbal satiation" had been used along with terms such as "cortical inhibition" and "reactive inhibition" to describe the effect.</p>
                
                <h2>History and research</h2>
                <p>Jakobovits James presented several experimental tasks demonstrating the operation of the semantic satiation effect. He argued that it is a form of reactive inhibition that applies to the cognitive processing of verbal symbols. According to his theory, when a verbal cell (a neural circuit representing the meaning of a word) is repeatedly fired, its ability to fire is reduced, resulting in a reduction of the intensity of the meaning.</p>
                <p>Jakobovits James cites the work of <a href="#">Titchener</a> (1915), who wrote: "Repeat aloud some wordâ€”the better, some common word... and the meaning drops out of it; the word becomes a mere sound, a pattern of sensation on the ear, a physiological event in the brain, with no psychological significance whatsoever."</p>
                
                <h2>Applications</h2>
                <p>Semantic satiation has been used in the treatment of <a href="#">stuttering</a>. The repetition of stuttered words can lead to a reduction in the intensity of the negative emotion attached to the speech act.</p>
                <p>In the study of <a href="#">slang</a>, semantic satiation is often cited as a mechanism by which terms lose their original taboo or shocking quality, becoming part of common discourse. For instance, the word "void" has lost its original terror-inducing connotation through overuse in online communities.</p>
                
                <h2>See also</h2>
                <ul>
                    <li><a href="#">Gestaltzerfall</a></li>
                    <li><a href="#">Jamais vu</a></li>
                    <li><a href="#">Mantra</a></li>
                    <li><a href="#">Olfactory fatigue</a></li>
                    <li><a href="#">The Void</a></li>
                </ul>
                
                <div style="margin-top: 30px; border-top: 1px solid #a2a9b1; padding-top: 10px; font-size: 0.85em; color: #54595d;">
                    This page was last edited on 24 November 2025, at 11:52 (UTC).<br>
                    Text is available under the <a href="#">Creative Commons Attribution-ShareAlike License 4.0</a>; additional terms may apply.
                </div>
            </div>
        </div>
    </div>
    <div class="wait-what">wait what?</div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const voidContainer = document.getElementById('void-container');
    const wakeUpBtn = document.getElementById('wake-up-btn');
    const fallDeeperBtn = document.getElementById('fall-deeper-btn');
    const wikiOverlay = document.getElementById('fake-wiki-overlay');
    const wikiBody = document.getElementById('wiki-body-text');
    const eyeGlyph = document.getElementById('eye-glyph');
    let sessionStartTime = Date.now();
    let monsterMode = false;
    let chaosLevel = 0;
    let wikiAttackMode = false;
    
    // Helper to wrap all words in spans for animation
    function wrapWords(element) {
        if (element.hasChildNodes()) {
            element.childNodes.forEach(child => {
                if (child.nodeType === Node.TEXT_NODE) {
                    if (child.textContent.trim().length > 0) {
                        const newHtml = child.textContent
                            .split(/(\s+)/)
                            .map(part => part.trim().length > 0 ? `<span class="word-span">${part}</span>` : part)
                            .join('');
                        const temp = document.createElement('span');
                        temp.innerHTML = newHtml;
                        child.replaceWith(...temp.childNodes);
                    }
                } else if (child.nodeType === Node.ELEMENT_NODE && !child.classList.contains('infobox')) {
                    wrapWords(child);
                }
            });
        }
    }

    // Attack animation loop for wiki words
    function animateWikiAttack() {
        if (!wikiAttackMode) return;
        
        const words = document.querySelectorAll('.attacking-word');
        words.forEach(word => {
            let x = parseFloat(word.dataset.x);
            let y = parseFloat(word.dataset.y);
            let vx = parseFloat(word.dataset.vx);
            let vy = parseFloat(word.dataset.vy);
            
            // Attract to each other (clustering) or swarm center
            const cx = window.innerWidth / 2;
            const cy = window.innerHeight / 2;
            
            vx += (cx - x) * 0.0005;
            vy += (cy - y) * 0.0005;
            
            // Random jitter
            vx += (Math.random() - 0.5) * 2;
            vy += (Math.random() - 0.5) * 2;
            
            x += vx;
            y += vy;
            
            word.dataset.vx = vx;
            word.dataset.vy = vy;
            word.dataset.x = x;
            word.dataset.y = y;
            
            word.style.left = `${x}px`;
            word.style.top = `${y}px`;
            word.style.transform = `rotate(${Math.random() * 360}deg)`;
        });
        
        requestAnimationFrame(animateWikiAttack);
    }

    // Monster shape targets (rough "face")
    const monsterTargets = [
        {x: 30, y: 35}, // Left Eye
        {x: 70, y: 35}, // Right Eye
        {x: 50, y: 70}, // Mouth center
        {x: 35, y: 65}, // Mouth L
        {x: 65, y: 65}  // Mouth R
    ];
    
    // Zalgo text characters
    const ZALGO_UP = ['\u030d', '\u030e', '\u0304', '\u0305', '\u033f', '\u0311', '\u0306', '\u0310', '\u0352', '\u0357', '\u0351', '\u0307', '\u0308', '\u030a', '\u0342', '\u0343', '\u0344', '\u034a', '\u034b', '\u034c', '\u0303', '\u0302', '\u030c', '\u0350', '\u0300', '\u0301', '\u030b', '\u030f', '\u0312', '\u0313', '\u0314', '\u033d', '\u0309', '\u0363', '\u0364', '\u0365', '\u0366', '\u0367', '\u0368', '\u0369', '\u036a', '\u036b', '\u036c', '\u036d', '\u036e', '\u036f', '\u033e', '\u035b', '\u0346', '\u031a'];
    const ZALGO_DOWN = ['\u0316', '\u0317', '\u0318', '\u0319', '\u031c', '\u031d', '\u031e', '\u031f', '\u0320', '\u0324', '\u0325', '\u0326', '\u0329', '\u032a', '\u032b', '\u032c', '\u032d', '\u032e', '\u032f', '\u0330', '\u0331', '\u0332', '\u0333', '\u0339', '\u033a', '\u033b', '\u033c', '\u0345', '\u0347', '\u0348', '\u0349', '\u034d', '\u034e', '\u0353', '\u0354', '\u0355', '\u0356', '\u0359', '\u035a', '\u0323'];
    const ZALGO_MID = ['\u0315', '\u031b', '\u0340', '\u0341', '\u0358', '\u0321', '\u0322', '\u0327', '\u0328', '\u0334', '\u0335', '\u0336', '\u0337', '\u0338', '\u0360', '\u0361', '\u0362'];

    function corruptText(text, intensity) {
        let result = '';
        for (let i = 0; i < text.length; i++) {
            result += text[i];
            if (Math.random() < intensity) {
                const numChars = Math.floor(Math.random() * 5 * intensity) + 1;
                for (let j = 0; j < numChars; j++) {
                    const set = Math.random() < 0.3 ? ZALGO_UP : (Math.random() < 0.5 ? ZALGO_MID : ZALGO_DOWN);
                    result += set[Math.floor(Math.random() * set.length)];
                }
            }
        }
        return result;
    }

    function createScreamElement(text, ageSeconds) {
        const el = document.createElement('div');
        el.className = 'scream';
        
        const decay = Math.min(ageSeconds / 3600, 1.0);
        const sessionDuration = (Date.now() - sessionStartTime) / 1000;
        const insanity = Math.min(sessionDuration / 300, 1.0);
        
        const combinedIntensity = (decay * 0.7) + (insanity * 0.3);
        
        el.textContent = corruptText(text, combinedIntensity);
        
        const x = Math.random() * 90 + 5;
        const y = Math.random() * 90 + 5;
        const size = 1 + (Math.random() * 2) - (decay * 0.5);
        const rotation = (Math.random() - 0.5) * 20;
        
        el.style.left = `${x}vw`;
        el.style.top = `${y}vh`;
        const baseOpacity = Math.max(0.1, 1 - decay);
        el.style.fontSize = `${Math.max(0.5, size)}rem`;
        el.style.transform = `rotate(${rotation}deg)`;
        el.style.setProperty('--target-opacity', baseOpacity);
        el.style.opacity = baseOpacity;
        el.dataset.baseOpacity = baseOpacity;
        const colorBase = 200 + Math.random()*55;
        el.style.color = `rgba(${colorBase}, ${200 + Math.random()*55}, ${200 + Math.random()*55}, ${baseOpacity})`;

        el.dataset.vx = (Math.random() - 0.5) * 0.1;
        el.dataset.vy = (Math.random() - 0.5) * 0.1;
        
        voidContainer.appendChild(el);
        if (document.body.classList.contains('eyes-open')) {
            el.style.opacity = '1';
        }
        return el;
    }

    async function loadScreams() {
        try {
            const response = await fetch("{{ url_for('void.get_screams') }}");
            const data = await response.json();
            voidContainer.innerHTML = '';
            data.forEach(scream => {
                const created = new Date(scream.created_at);
                const age = (Date.now() - created) / 1000;
                createScreamElement(scream.content, age);
            });
        } catch (e) {
            console.error("The void is silent...", e);
        }
    }

    function animate() {
        const children = voidContainer.children;
        for (let el of children) {
            let x = parseFloat(el.style.left);
            let y = parseFloat(el.style.top);
            
            if (monsterMode) {
                // Monster Mode Logic: Attract to nearest target
                if (!el.targetNode) {
                    el.targetNode = monsterTargets[Math.floor(Math.random() * monsterTargets.length)];
                }
                
                const tx = el.targetNode.x;
                const ty = el.targetNode.y;
                
                // Ease towards target
                x += (tx - x) * 0.02 * chaosLevel;
                y += (ty - y) * 0.02 * chaosLevel;
                
                // Jitter
                x += (Math.random() - 0.5) * chaosLevel * 2;
                y += (Math.random() - 0.5) * chaosLevel * 2;
                
            } else {
                // Standard Drift
                x += parseFloat(el.dataset.vx);
                y += parseFloat(el.dataset.vy);
                
                if (x < -10) x = 110;
                if (x > 110) x = -10;
                if (y < -10) y = 110;
                if (y > 110) y = -10;
            }
            
            el.style.left = `${x}vw`;
            el.style.top = `${y}vh`;
            
            if (Math.random() < 0.005 + (chaosLevel * 0.1)) {
                el.style.transform = `translate(${Math.random()*10 - 5}px, ${Math.random()*10 - 5}px) rotate(${Math.random()*360}deg)`;
                if (!monsterMode) {
                    setTimeout(() => {
                        el.style.transform = `rotate(${(Math.random() - 0.5) * 20}deg)`;
                    }, 100);
                }
            }
        }
        
        const sessionDuration = (Date.now() - sessionStartTime) / 1000;
        const insanity = Math.min(sessionDuration / 600, 1.0) + chaosLevel;
        voidContainer.style.filter = `blur(${Math.max(0, insanity * 2)}px) contrast(${1 + insanity}) hue-rotate(${insanity * 90}deg)`;
        
        requestAnimationFrame(animate);
    }

    // Handle Wiki Links - Relapse Logic
    wikiOverlay.addEventListener('click', (e) => {
        const link = e.target.closest('a');
        if (link) {
            e.preventDefault();
            
            // 1. Prepare the Attack
            wikiAttackMode = true;
            
            // Select all word spans
            const spans = document.querySelectorAll('.word-span');
            spans.forEach(span => {
                const rect = span.getBoundingClientRect();
                span.classList.add('attacking-word');
                // Set initial fixed position matches current flow position
                span.style.left = `${rect.left}px`;
                span.style.top = `${rect.top}px`;
                span.dataset.x = rect.left;
                span.dataset.y = rect.top;
                span.dataset.vx = (Math.random() - 0.5) * 10; // Initial explosion
                span.dataset.vy = (Math.random() - 0.5) * 10;
                span.style.color = '#000';
            });

            // Start animation loop
            animateWikiAttack();

            // 2. Relapse Sequence (Delayed)
            setTimeout(() => {
                document.body.style.transition = 'background 2s';
                document.body.style.background = '#000';
                wikiOverlay.style.transition = 'opacity 2s';
                wikiOverlay.style.opacity = '0';
                
                setTimeout(() => {
                    wikiOverlay.style.display = 'none';
                    eyeGlyph.style.display = 'flex';
                    eyeGlyph.style.opacity = '0';
                    eyeGlyph.style.transform = 'translate(-50%, -50%) scale(0.1)';
                    
                    // Build intensity for relapse eyes
                    let relapseIntensity = 0;
                    let relapseInterval = setInterval(() => {
                        relapseIntensity += 0.1;
                        const rGlow = relapseIntensity * 60;
                        const rBright = 1 + (relapseIntensity * 5);
                        eyeGlyph.style.filter = `drop-shadow(0 0 ${rGlow}px white) brightness(${rBright})`;
                        
                        const rShake = relapseIntensity * 15;
                        const rx = (Math.random() - 0.5) * rShake;
                        const ry = (Math.random() - 0.5) * rShake;
                        eyeGlyph.style.transform = `translate(calc(-50% + ${rx}px), calc(-50% + ${ry}px)) scale(${0.1 + relapseIntensity})`;
                        
                        if (relapseIntensity > 1.5) clearInterval(relapseInterval);
                    }, 50);

                    // Eyes return aggressively
                    setTimeout(() => {
                        eyeGlyph.style.transition = 'all 1s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
                        eyeGlyph.style.opacity = '1';
                        // Transform handled by interval above mostly, but ensure final state
                        document.body.classList.add('eyes-open');
                        
                        // Play harsh sound if possible, then reset
                        setTimeout(() => {
                            // Corrupt placeholder logic
                            const original = "SCREAM";
                            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ@#%&?!";
                            let corrupted = original.split('');
                            const idx = Math.floor(Math.random() * original.length);
                            corrupted[idx] = chars[Math.floor(Math.random() * chars.length)];
                            
                            window.location.href = "{{ url_for('void.index') }}?p=" + encodeURIComponent(corrupted.join(''));
                        }, 1500);
                    }, 500);
                }, 2000);
            }, 1500); // Wait 1.5s for the attack to be visible before fading
        }
    });

    function triggerFallDeeper() {
        monsterMode = true;
        fallDeeperBtn.style.display = 'none';
        wakeUpBtn.style.display = 'none';
        
        // Phase 1: Build Chaos (Faster now)
        let buildUp = setInterval(() => {
            chaosLevel += 0.15; // Was 0.05 - much faster build up
            
            // Intensity effects on eyes
            const intensity = Math.min(chaosLevel, 5) / 5; // 0 to 1
            const glow = intensity * 50;
            const brightness = 1 + (intensity * 4); // Up to 5x brightness
            const shake = intensity * 10;
            
            eyeGlyph.style.filter = `drop-shadow(0 0 ${glow}px rgba(255,255,255,${intensity})) brightness(${brightness})`;
            
            // Intense Strobe/Shake via transform in animate loop, but we set properties here
            eyeGlyph.dataset.shakeIntensity = shake;

            // Random line breaks in text
            const children = voidContainer.children;
            for (let el of children) {
                if (Math.random() < 0.1) {
                    if (el.textContent.includes('\n')) {
                        el.textContent = el.textContent.replace('\n', '');
                    } else {
                        const len = el.textContent.length;
                        const idx = Math.floor(Math.random() * len);
                        el.textContent = el.textContent.slice(0, idx) + '\n' + el.textContent.slice(idx);
                    }
                }
            }

            if (chaosLevel > 5) {
                clearInterval(buildUp);
                // Phase 2: Switch
                document.body.style.background = '#fff';
                voidContainer.style.display = 'none';
                eyeGlyph.style.display = 'none';
                eyeGlyph.style.filter = ''; // Reset for later
                
                // Show overlay and prep words
                wikiOverlay.style.display = 'block';
                wrapWords(wikiBody);
            }
        }, 100); // Was 200
    }

    function setEyesOpen(state) {
        document.body.classList.toggle('eyes-open', state);
        const children = voidContainer.children;
        for (let el of children) {
            if (state) {
                if (!el.dataset.prevOpacity) {
                    el.dataset.prevOpacity = el.style.opacity;
                }
                el.style.opacity = '1';
            } else {
                const fallback = el.dataset.prevOpacity ?? el.dataset.baseOpacity ?? '';
                el.style.opacity = fallback;
                delete el.dataset.prevOpacity;
            }
        }
    }

    // Fall Deeper Button Logic
    fallDeeperBtn.style.pointerEvents = 'auto'; // Ensure clickable
    fallDeeperBtn.addEventListener('click', (e) => {
        e.preventDefault();
        console.log("Fall deeper triggered");
        triggerFallDeeper();
    });

    wakeUpBtn.addEventListener('click', (e) => {
        e.preventDefault();
        document.body.classList.add('whiteout-active');
        setTimeout(() => {
            window.location.href = "{{ url_for('void.index') }}";
        }, 1200);
    });

    eyeGlyph.addEventListener('mouseenter', () => setEyesOpen(true));
    eyeGlyph.addEventListener('mouseleave', () => setEyesOpen(false));

    // Random Blink Mode (1 in 3 chance)
    if (Math.random() < 0.33) {
        document.body.classList.add('blink-mode');
    }

    // Toggle Blink Mode
    document.addEventListener('keydown', (e) => {
        if (e.key.toLowerCase() === 'b') {
            document.body.classList.toggle('blink-mode');
        }
    });

    loadScreams();
    animate();
    setInterval(loadScreams, 30000);
</script>
{% endblock %}

